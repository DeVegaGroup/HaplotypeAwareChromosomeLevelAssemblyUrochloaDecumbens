1/generate allelic table from unitigs:



1A/ Run busco5 with the 4 plant families in the unitigs:

/ei/.project-scratch/d/df376f99-21e5-42cb-bdd0-96c4fa097214/allhic-unitigs/ _run_busco5.sh

Which generated these outputs:

/ei/.project-scratch/d/df376f99-21e5-42cb-bdd0-96c4fa097214/allhic-unitigs/try1.hic.p_utg.gfa.fasta_busco5_*



1B/ concatenate the proteins generated by busco5 and “diamond blastp” all-vs-all:

/ei/.project-scratch/d/df376f99-21e5-42cb-bdd0-96c4fa097214/allhic-unitigs-try2/blastp_4annots/ _run_selfaligment.sh



1C/ the allelic table also has the chr position for each marker, for the partition step. However this would not have been necessary.

/ei/.project-scratch/d/df376f99-21e5-42cb-bdd0-96c4fa097214/allhic-unitigs-try2/blastp_4annots/

_run_mapdiploid.sh

_run_addchromosomes.sh



The final table is “allelic_table.txt”



2/ reads to bam with the pipeline from phase genomics:

/ei/.project-scratch/d/df376f99-21e5-42cb-bdd0-96c4fa097214/allhic-unitigs/_run_bwa.sh

Generated try1.hic.p_utg.gfa.fasta.sort.bam



3/ Prune the bam with the allelic table:

/ei/.project-scratch/d/df376f99-21e5-42cb-bdd0-96c4fa097214/allhic-unitigs-try2/pruning_with_allelic_table_4annots

ALLHiC_prune -i allelic_table.txt -b try1.hic.p_utg.gfa.fasta.sort.bam -r try1.hic.p_utg.gfa.fasta

Generates removedb_Allele.txt (and other files that can be remove)



4/ Remove allelic links from bam:

cat removedb_Allele.txt  | cut -f3 | tr ',' '\n' | awk '!x[$1]++' | grep ':' > removedb_Allele.list_reads_to_remove.txt

sbatch --mem 100G -c 4 --wrap="source samtools-1.15 && samtools view try1.hic.p_utg.gfa.fasta.sort.bam  | fgrep -vf removedb_Allele.list_reads_to_remove.txt | samtools view -@ 4 -bt try1.hic.p_utg.gfa.fasta.fai > try1.hic.p_utg.gfa.fasta.sort.pruned_for_allelic.bam"





5/ sort bam by readname

sbatch --mem 50G --wrap="samtools sort -n try1.hic.p_utg.gfa.fasta.sort.pruned_for_allelic.bam > try1.hic.p_utg.gfa.fasta.sort.pruned_for_allelic.sorted_by_read_name.bam"



6/ run yahs + juicer pre + juicer tools

/ei/.project-scratch/d/df376f99-21e5-42cb-bdd0-96c4fa097214/allhic-unitigs-try2/pruning_with_allelic_table_4annots/partition_out/_run_yahs_q20.sh

Generated

juicer_tools_q20.out.hic

yahs_q20_juicer.assembly

https://dgenies.toulouse.inra.fr/result/q20



7/ manual curation in the GUI



8/ juicer post

Generated:

yahs_juicer_review1* (split scaffold1)

yahs_juicer_review2* (split scaffold1 and 2): https://dgenies.toulouse.inra.fr/result/yahs_juicer_review2FINALfagz
